
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>I2问问分享问题</title>

    


<script type="text/javascript">var ctx = "";</script>
<link rel="stylesheet" type="text/css"
      href="./static/3rd-extends/jquery-easyui-1.4.2/themes/bootstrap/easyui.css">

<link rel="stylesheet" href="./mobile/static/assets/css/amazeui.min.css">

<link rel="stylesheet" href="./mobile/static/css/iconfont.css">
<link rel="stylesheet" href="./mobile/static/assets/css/app.css?"+Math.random()>


	<script src="./mobile/static/assets/js/jquery.min.js"></script>
	<script src="./webchataudio/src/js/weixinAudio.js" type="text/javascript" charset="utf-8"></script>
	<script src="./mobile/static/assets/js/iscroll.js"></script>
	<script type="text/javascript" src="./static/3rd-extends/jquery-easyui-1.4.2/jquery.easyui.min.js"></script>
	<script src="./mobile/static/assets/js/amazeui.min.js"></script>
	<script src="./mobile/static/assets/js/handlebars.min.js"></script>
	<script src="./mobile/static/assets/js/amazeui.widgets.helper.min.js"></script>
	<script src="https://cdn.bootcss.com/jquery-cookie/1.3.0/jquery.cookie.js"></script>
	<script src="./mobile/static/assets/js/app.js?"+Math.random()></script>
	<script src="./mobile/static/js/plugin/eventList.js?v=2.0"></script>

    <link rel="stylesheet" href="./mobile/static/css/custom-soroll.css">

    <style>

		body{
			line-height: 1.2;
		}
        #wrapper {
            position: initial;
            background-color: #f9f9f9;
        }

        .am-list {
            margin-bottom: 0rem; top:0rem;
        }


        .am-list>li{
            border-width: 0px;
        }
        .am-nav>li>a {
            padding: .4em 0em;
        }



		.regist_head_ss{
			position: relative;
			vertical-align: middle;
		    border-bottom: 1px solid #cfcfcf;
		    height: 60px;
		    line-height: 60px;
		}
		.regist_head_ss .img_l{
			display: inline-block;
			vertical-align: middle;
			margin-left: 1rem;
		    width: 35px;
		}

		.regist_head_ss .tit{
			display: inline-block;
		    font-size: 14px;
		    margin: 0;
		    font-weight: 400;
		}
		.regist_head_ss .sp{
			position: absolute;
			top: 18px;
			display: inline-block;
			height: 26px;
			line-height: 26px;
			right: 10px;
		    background-color: #7c94f9;
		    padding: 0px 15px;
		    border-radius: 3px;
		    color: white;
		    font-size: 14px;
		}


    </style>
	<script src="mobile/static/js/plugin/eventList.js"></script>
</head>
<body style="background-color: #ece9e9">

<div class="am-tabs" id="doc-my-tabs" style="background-color: #fff">
   
        <div class="regist_head_ss">
            <img class="img_l" src="./mobile/static/image/head_img.png">
            <h3 class="tit">I2问问</h3>
            <span class="sp"><a onclick="openApp()"  style='color:#fff'>下载</a></span>
            <!--<span class="sp"><a onclick="app.loginOut()"  style='color:#fff'>退出登录</a></span>-->
        </div>

        <div class="am-tab-panel js-pro" style="overflow: auto;height: 100%">

        </div>
</div>

</body>

<script type="text/x-handlebars-template" id="pro-details">
           	<div class="problem-head">
				<div class="avatar">{{firstString owner.firstName}}</div>
				<div class="userInfo name">{{owner.firstName}}</div>
				<div class="userInfo time">{{solutionCutOffDate}}</div>

				
				<div class='userInfo status {{statusColor status}}'>{{status}}</div>
              
					
			
        	</div>

        	<div class="problem-title">
				{{title}}
        	</div>

        	<div class="problem-body">
				<div class='body-shenglv js-chankai'>
		        	{{#each content}}

					   {{#if img}}
							<div class="img">
								<img src={{value}} alt="">
							</div>
		                {{/if}}

					{{/each}}

					{{#each content}}
						{{#if text}}
							<div class="text">{{value}}</div>
						{{/if}}
					{{/each}}

					{{#each content}}
						{{#if audio}}
							<div style="margin-top: 10px;" class="audio" time="{{time}}" src='{{value}}'></div>
						{{/if}}
					{{/each}}



					 {{#each relates}}
					  <div class="part">
							<div class="part-item">
								<i class="iconfont icon-guanlianlingjian"></i>
								<span class='js-gotoPart' data-partID='{{partID}}' data-basePartID='{{basePartID}}'>{{code}}/ {{revision}} {{relatedPartSummary}}</span>
							</div>
						</div>
					{{/each}}

				</div>

				 <div class="body-xianshi js-chankai">
					 {{#each content}}

					 {{#if img}}
					 <div class="img">
						 <img src={{value}} alt="">
					 </div>
					 {{/if}}

					 {{#if text}}
					 <div class="text">{{value}}</div>
					 {{/if}}

					 {{#if audio}}
					 <div style="margin-top: 10px;" class="audio" time="{{time}}" src='{{value}}'></div>
					 {{/if}}

					 {{/each}}

					 {{#each relates}}
					 <div class="part">
						 <div class="part-item">
							 <i class="iconfont icon-guanlianlingjian"></i>
							 <span class='js-gotoPart' data-partID='{{partID}}' data-basePartID='{{basePartID}}'>{{code}}/ {{revision}} {{relatedPartSummary}}</span>
						 </div>
					 </div>
					 {{/each}}
			    </div>

        	</div>
			<div style='height: 1rem;background: #ece9e9;border-top: 1px solid #D6D6D6;border-bottom: 1px solid #D6D6D6;'></div>


			<div class="newAnswer-head">
				<i class="iconfont icon-zuixinhuida"></i>
				<span>最新回答</span>
			</div>

            {{#if hasSolution}}
		     	<div class="newAnswer-head">
					<div class="avatar">{{firstString leastSolution.creator.firstName}}</div>
					<div class="userInfo name">{{leastSolution.creator.firstName}}</div>
					<div class="userInfo time">{{leastSolution.dateCreated}}</div>
	        	</div>

	        	<div class="newAnswer-body">
					<div class="text">
						{{leastSolutionSummary}}
					</div>
	        	</div>

	        {{else}}
	            <div style="text-align: center;">
					暂无回答
	            </div>
	        {{/if}}
			

		

        	<div class="participants">
				<div class="participants-head">
					<i class="iconfont icon-iconfontweibiaoti1"></i>
					<span>参与者</span>
				</div>

				<div class="participants-body">
					{{#if solver}}
						<div class="avatar">{{firstString solver.firstName}}</div>
					{{else}}
						<div class="avatar"><i class="iconfont icon-huida" style="font-size:26px;"></i></div>
					{{/if}}



				<!-- 分割线 -->
 				{{#if participantList.length}}
					<span style="display:inline-block;line-height: 3rem;height: 3rem;border-left: 1px solid #ccc;margin:0 5px;"></span>
                {{/if}}
				

				{{#each participantList}}
				  	<div class="avatar">{{firstString user.firstName}}</div>
				 {{/each}}

				<!-- 分割线 -->
				{{#if shareList.length}}
					<span style="display:inline-block;line-height: 3rem;height: 3rem;border-left: 1px solid #ccc;margin:0 5px;"></span>
                {{/if}}

				{{#each shareList}}
				  	<div class="avatar">{{firstString user.firstName}}</div>
				 {{/each}}

				</div>

				{{#each logs}}
				<div class="problem-log">
					<i class="iconfont icon-huida"></i>
					<span class='text' style="position: absolute;left: 20px;top: 3px;font-size:11px">
						<span style="font-size:11px">{{userName}}</span>{{message}}</span>
					<span class='text' style="position: absolute;right: 10px;top: 3px;">{{createDate}}</span>
				</div>
				{{/each}}
        	</div>
</script>



<script>
    $(function () {

        if( app.params.type=='Invite'){

		}else{
            app.commonAjax({
                url:'/MobileApp/Share/addReceivedShare.do',
                data:{
                    receiverIDs: app.params.userID,
                    sharerID:app.params.sharerID,
                    ownerID:app.params.ownerID,
                    type:app.params.type,
                    ID:app.params.ID
                },
                success:function(data){

                }
            })
		}



        

  		//判断 当前数量 是i 不是大于 3
          Handlebars.registerHelper("isOne",function(value){
           		if(value==0){
           			return true
           		}
           		return false;
          });



  		//注册一个翻译用的Helper获取字符串第一个字符
          Handlebars.registerHelper("firstString",function(value){
           		if(value){
           			return value.slice(0,1)
           		}
           		return '';
          });

          	//注册一个翻译用的Helper获取状态对应的颜色
          Handlebars.registerHelper("statusColor",function(value){
           		if(value =='已关闭'){
           			return 'red'
           		}
           		return 'green';
          });
 	
        /*-------------------整体页面开始-------------------------------------------------*/



         var proCompiler = Handlebars.compile($('#pro-details').html());
         app.commonAjax({
        	url:'/MobileApp/Issue/getIssueDetail.do',

        	// url:'./static/list.json',
        	// contentType:'application/x-www-form-urlencoded',
        	data:{
        		objectID:app.params.objectID,
        		corpID:app.params.ownCorpID,
        	},
        	success:function(data){
        		if(data.code==0){

        			//问题内容
        			data.flag=true;
        			try{
						data.data.content=data.data.contents
						data.data.content.map(function(obj,i){
							if(obj.key=='img'){
								obj.img=true;
							}else if(obj.key=='text'){
								obj.text=true;
							}else if(obj.key=='audio'){
								obj.audio=true
							}
							console.log(obj)
						});

        			}catch(e){
        				data.flag=false;
        			}


        			if(data.data.leastSolution && data.data.leastSolution.id){

        			    var mark = data.data.leastSolution.summaryMark;
        			    var summary = data.data.leastSolution.summary;

                        var leastSolutionSummary = mark==0 ? summary || ' ':
                            mark==3?'[图片][语音]':mark==2 ? '[语音]' : mark==1?'[图片]':' '
        				data.data.hasSolution=true;
        				data.data.leastSolutionSummary=data.data.leastSolution.creator.firstName + ":" + leastSolutionSummary;
        			}

					$('.js-pro').html(proCompiler(data.data));


					var obj = $('.audio').weixinAudio({
						autoplay:false,
					});

					$('.js-chankai').click(function(){
		                var _this=$(this);
						$('.js-chankai').show();
						_this.hide();
		            })

			         $('.js-gotoPart').unbind('click').bind('click',function(e){
			         	e.stopPropagation();
			         	var partID = $(this).attr('data-partID');
			         	var basePartID= $(this).attr('data-basePartID');
			         	var obj = $.extend({},{
			                sid:app.params.sid,
			                tid:app.params.tid
			            },{
			            	ownCorpID:app.params.ownCorpID,
			            	partID:partID,
			            	basePartID:basePartID
			            })

			            var url='/Mobile/Share/index.html';

			            url= app.addUrlParams(window.location.origin + url,obj)

			            window.location.href= url;
			         });

        		}else{

        		    if(data.code==11){
						app.loginOut();
					}else{
                        app.showAlert("Error:"+data.code+",Message:"+data.message);
					}
        		}
        	}
        })




    })
</script>

<script src="./mobile/static/js/plugin/openApp.js?"+Math.random()></script>
</html>
<!--http://pnc.co.il/dev/iscroll-5-pull-to-refresh-and-infinite-demo.html-->
